---
description: Master Development Rules
globs:
  - "**/*.py"
  - "**/*.md"
  - "**/*.yaml"
  - "**/*.json"
alwaysApply: true
---

ðŸš¨ Master Rules â€“ Non-Negotiable

1. **Endpoints & APIs**
   - Never create new endpoints unless explicitly mentioned in task.
   - All routes must be thin (call services only) and documented in `/docs/api.md`.
   - OpenAPI/Swagger must be auto-generated + human-readable doc updated.

2. **External & Internal API Usage**
   - If a service calls another API (internal/external):
     - Define **Pydantic request/response models** for inputs/outputs.
     - Add test coverage for success, failure, and edge cases of that API call.
     - Document in `/docs/apis-used.md`:
       - API name, base URL, endpoints used
       - Data models (req/res)
       - Purpose in system
       - Auth/headers/limits if any
   - No direct raw HTTP calls in business logic â€” must go through a client wrapper.

3. **Tests**
   - Never generate new test scripts if a relevant one exists â†’ always extend/refactor existing.
   - No redundant/duplicate tests across unit/integration/e2e.
   - Temp/debug tests must auto-delete after use.
   - All test results stored in `/tests/results/` (JSON + Markdown summary).
   - Coverage must stay constant or improve.

4. **Code Style & Size**
   - Max **300 LOC per script** (refactor/split if larger).
   - Use existing logic â€” never rewrite unless impossible.
   - No mock/fallback data unless explicitly requested.
   - Enums + Pydantic models mandatory for all data contracts.
   - Use dependency injection everywhere (no inline instantiation).

5. **Documentation**
   - Every module/class/function â†’ docstring (Google/Numpy style).
   - Each folder â†’ `README.md` with purpose, entry points, dependencies, examples.
   - Keep `/docs/` always updated:
     - `architecture.md`, `folder-structure.md`, `information-flow.md`
     - `api.md`, `services.md`, `cron.md`, `db-schema.md`, `config.md`
     - `apis-used.md` (all external/internal APIs consumed by services)
     - ADRs in `/docs/adr/` for major decisions
   - `/CHANGELOG.md` mandatory for all changes.

6. **Structure & Flow**
src/
api/ # Routes/controllers (thin)
services/ # Business logic (stateless, reusable)
db/ # Repositories, ORM models
models/ # Pydantic/dataclasses (contracts)
tasks/ # Cron jobs
ui/ # Frontend
common/ # Utils, constants, logging
config/ # Env + DI
tests/ # Unit, integration, e2e, regression
docs/ # Architecture, flows, ADRs, results, apis-used
logs/ # Dev logs (ignored in git)
debug/ # Debug artifacts (ignored in git)

markdown
Copy code

7. **Logging & Debugging**
- Use central JSON logger (timestamp, level, module, message, trace).
- No `print()`, no secret logging.
- Dev: verbose console + SQL/debug info.
- Prod: JSON logs only (INFO+, stdout/stderr).
- Debugging artifacts â†’ `/debug/` (git-ignored).

8. **Deployment & Config**
- Always have `entrypoint.sh`, `config.yaml`, `config.py`.
- Vars flow: env â†’ config loader â†’ DI â†’ services.
- Deployment steps: run locally â†’ docker-compose â†’ deploy (fix issues iteratively).

9. **Strictly Forbidden**
- New endpoints without approval.
- Redundant/unused test scripts.
- Dead code, commented-out code, placeholders.
- Hardcoded values (use config/env).
- â€œJust in caseâ€ abstractions.
- >300 LOC per file.
- API calls without data models and `/docs/apis-used.md` entry.

âœ… With these rules, every service API usage is:
- **Documented** (`apis-used.md` + models).
- **Tested** (success/failure flows).
- **Structured** (client wrapper + DI, no raw calls).

DEV on port - 8079 and prod on 8179
